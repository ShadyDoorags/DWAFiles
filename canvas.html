<!DOCTYPE html>
<html>
<head> 
<style type="text/css">

*{
	box-sizing: border-box;
    -moz-box-sizing: border-box;
}

#overlay{
z-index: 999;
}




    
/*Colors*/
#toolbar{
 	width: 70px;
    height: 879px;
    padding: 0px;
    position: fixed;
    right: 0;
    top: 0;
    background-color: #e7ffff;
    color: white;
    border: 2px solid black;
    }
    
    
#colors{
	float: left;
    margin-top: 40px;
    
}
    .swatch{
    	width: 39px;
        height: 39px;
        border-radius: 15px;
        box-shadow: inset 0px 1px 0px rgba(255, 255, 255, 0.5), 0px 2px 2px rgba(0, 0, 0, 0.5);
        display: inline-block;
        margin-left: 13px;
        background-color: cyan;
}

.swatch.active{
	border: 2px solid white;
    box-shadow: inset 0px 1px 2px rgba(0, 0, 0, 0.5);
}


#clearCanvas{
position: fixed;
left: 0;
top:0;
margin-top: 4px;
margin-left: 716px;
font-weight: bold;
background-color: #ffffff;
width: 55px;
height: 30px;
}

#paintBucketButton{
position: fixed;
left: 0;
top: 0;
margin-top: 34px;
margin-left: 716px;
background-color: #ffffff;
width: 55px;
height: 30px;
}
#brushButton{
position: fixed;
left: 0;
top: 0;
margin-top: 64px;
margin-left: 716px;
background-color: #ffffff;
width: 55px;
height: 30px;
}




</style>
</head>
    
<body style='margin: 0'>
        
   
<div id="debug" style="position:relative;left:903px;"></div>
    <div id="toolbar">
    	<div id="colors"></div>
    	<div><input id="clearCanvas" type="button" value="CLEAR">
    </div>
	<div>
	<input id="brushButton" type="button" onclick="setMode('brush')" value="Brush"> <!--style="position:absolute;left:903px;"--> <br/>
        </div>
	<div>
	<input id="paintBucketButton" type="button" onclick="setMode('bucket')" value="Bucket"> <!--style="position:absolute;left:903px;"--> <br/>
        </div>
 
</div>
</div>

        
    
	
	
	<canvas onclick="fill(event)" id="canvas" width="903" height="996" style= "border:2px solid #000000; position:absolute; left:0px; top:0px">
	Aw man! It looks like you are using a lame browser. Try a cooler browser to join in on the fun!
	</canvas>
    
	
    
    <script>
	
	
//CLEAR CANVAS
var clearCanvas = document.getElementById('clearCanvas');
document.getElementById('clearCanvas').addEventListener('click', function() {
        //context.clearRect(0, 0, canvas.width, canvas.height);
		context.beginPath();
		context.fillStyle = selectedColor;
		context.strokeStyle = selectedColor;
		context.fillRect(0, 0, canvas.width, canvas.height);		
		context.fill();
      }, false);

  
//DRAW
var canvas = document.getElementById('canvas');
var context= canvas.getContext('2d');
var radius = 5;
var dragging = false;
var paintBucketActive = false;
var paintBucketButton = document.getElementById('paintBucketButton');
var debug = document.getElementById('debug');

const modes = {brush :"brush", bucket:"bucket"};

mode = "";



var selectedColor;

canvas.width = 688;
canvas.height = 875;


context.lineWidth = radius*2

var putPoint = function(e){
	
    //imageObj.remove();
	if (dragging){
	context.lineTo(e.clientX, e.clientY); //draw an invisible line
	context.stroke(); //make the line visible
	context.beginPath();//start a new path
	context.arc(e.clientX, e.clientY, radius, 0, Math.PI*2); //draw a circle
	context.fill(); //fill the context with this color (so fill the circle)
	context.beginPath(); //reset the path
	context.moveTo(e.clientX, e.clientY); //move the context to the current position
	}
    //imageFunction(e);
}

var click = function(e){
if(mode == modes.brush){
	dragging = true;
	putPoint(e);
	}
}

var release = function(){
	dragging = false;
	context.beginPath ();
}

canvas.addEventListener('mousedown', click);
canvas.addEventListener('mousemove', putPoint);
canvas.addEventListener('mouseup', release);

//COLOR
var colors = ['black', 'white', 'grey', 'Bisque', 'LightSalmon', 'red', 'Maroon', 'Chocolate', 'orange', 'yellow', 'Chartreuse', 'SpringGreen', 'green', 'blue', 'DeepSkyBlue', 'cyan', 'indigo', 'BlueViolet', 'violet', 'deepPink'];


for(var i=0, n=colors.length;i<n;i++){
	var swatch = document.createElement('div');
    swatch.className = 'swatch';
    swatch.style.backgroundColor = colors[i];
    swatch.addEventListener('click', setSwatch);
    document.getElementById('colors').appendChild(swatch);
}

function setColor(color){
	context.fillStyle = color;
    context.strokeStyle = color;
    var active = document.getElementsByClassName('active')[0];
    if(active){
    		active.className = 'swatch';
    }
}


function setSwatch(e){
	var swatch = e.target;
    setColor(swatch.style.backgroundColor);
	selectedColor = swatch.style.backgroundColor;
    swatch.className += ' active';
}

setSwatch({target: document.getElementsByClassName('swatch')[0]});


//ADDED SCRIPTS BY SHADY

function setMode(newMode){
mode = newMode;
}
	
	//getting coordinates
	
	//this code was used for other functions
	function showCoords(event){
	var x = event.clientX;
    var y = event.clientY;
    var coords = "X coords: " + x + ", Y coords: " + y;
    debug.innerHTML = coords;
	}
	
	function checkColor(event){
	var x = event.clientX;
	var y = event.clientY;
	var imgData = context.getImageData(x,y,1,1);
	var red = imgData.data[0];
	var green = imgData.data[1];
	var blue = imgData.data[2];
	var alpha = imgData.data[3];
	debug.innerHTML = "rgba at " + x +", "+ y + " = " + red + ", " + green + ", " + blue +", " + alpha;
	}
	
	
	//used for algorithm search below
	
	var canvasArray = new Array(canvas.width);
	for(var i = 0; i < canvas.width; i++){
		canvasArray[i] = new Array(canvas.height);
	}
	
	function fill(event){
	if (mode == modes.bucket){
		nonRecursiveDepthFirstSearch();
	}
	}
	
	function nonRecursiveDepthFirstSearch(){
	
	//setup for the search
	arraySetUp();
	var x = event.clientX;
	var y = event.clientY;
	var imgData = context.getImageData(x,y,1,1);
	
	//store original color
	storedR = imgData.data[0];
	storedG = imgData.data[1];
	storedB = imgData.data[2];
	
	//generic blue color for testing
		
		//
	
	finished = false;
	var directionDecided = 0;
	
	var count = 0;
	
	while(!finished){
	count++;
	
	//resets
	directionDecided = 0;
	imgData = context.getImageData(x,y,1,1);
	
	//we've now visited this spot
	canvasArray[x][y].visited = true;
		
		//debug.innerHTML = debug.innerHTML + x +"," + y;
	
			//change the color of the image needs to go here	
		context.beginPath();
		context.fillRect(x,y,1,1);
		context.fillStyle = selectedColor;		
		context.fill();
		
		//check if we've gone right
		if(!canvasArray[x][y].right){
		//if it gets passed checkpoints, we go right
		directionDecided = 1;
			if(x+1 < canvas.width && x+1 >= 0){
				imgData = context.getImageData(x+1,y,1,1);
				//check if we've already gone there or if the color don't match
				if(canvasArray[x+1][y].visited || !(within10(imgData.data[0], storedR) && within10(imgData.data[1], storedG) && within10(imgData.data[2], storedB))){
					directionDecided = 0;
					//debug.innerHTML = debug.innerHTML + ": "+ x + ", " + y + " couldn't go right";
				}else{
				//debug.innerHTML = debug.innerHTML + ": "+ x + ", " + y + " is a match which means" + imgData.data[0] + " = " + storedR + " and " + imgData.data[1] + " = " + storedG + " and " + imgData.data[2] + " = " + storedB + " and ";
				}
			}else{
			//can't go out of bounds
				directionDecided = 0;
				//debug.innerHTML = debug.innerHTML + ": "+ x + ", " + y + " couldn't go right";
			}
		}else{
			debug.innerHTML = debug.innerHTML + ": "+ x + ", " + y + " couldn't go right";
		}
		
			if(directionDecided == 0 && !canvasArray[x][y].up){
		//if it gets passed checkpoints, we go up
		directionDecided = 2;
			if(y+1 < canvas.height && y+1 >= 0){
				imgData = context.getImageData(x,y+1,1,1);
				//check if we've already gone there or if the color don't match
				if(canvasArray[x][y+1].visited || !(within10(imgData.data[0], storedR) && within10(imgData.data[1], storedG) && within10(imgData.data[2], storedB))){
					directionDecided = 0;
				}
			}else{
			//can't go out of bounds
				directionDecided = 0;
			}
		}
		
	if(directionDecided == 0 && !canvasArray[x][y].left){
		//if it gets passed checkpoints, we go left
		directionDecided = 3;
			if(x-1 < canvas.width && x-1 >= 0){
				imgData = context.getImageData(x-1,y,1,1);
				//check if we've already gone there or if the color don't match
				if(canvasArray[x-1][y].visited || !(within10(imgData.data[0], storedR) && within10(imgData.data[1], storedG) && within10(imgData.data[2], storedB))){
					directionDecided = 0;
				}
			}else{
			//can't go out of bounds
				directionDecided = 0;
			}
		}
		
		if(directionDecided == 0 && !canvasArray[x][y].down){
		//if it gets passed checkpoints, we go down
		directionDecided = 4;
			if(y-1 < canvas.height && y-1 >= 0){
				imgData = context.getImageData(x,y-1,1,1);
				//check if we've already gone there or if the color don't match
				if(canvasArray[x][y-1].visited || !(within10(imgData.data[0], storedR) && within10(imgData.data[1], storedG) && within10(imgData.data[2], storedB))){
					directionDecided = 0;
				}
			}else{
			//can't go out of bounds
				directionDecided = 0;
			}
		}
		
		
		
		//direction is decided, follow through
		
		switch(directionDecided){
		case 0:
		//can't go further, so go back
		if(canvasArray[x][y].home == 0){
		
		//reached origin and can't go anywhere so you're done
		finished = true;
		
		}else if(canvasArray[x][y].home == 1){
		//came from the right, go back there
		x++;
		
		}else if(canvasArray[x][y].home == 2){
		//came from up, go back there
		y++;
		
		}else if(canvasArray[x][y].home == 3){
		//came from the left, go back there
		x--;
		
		}else if(canvasArray[x][y].home == 4){
		//came from down, go back there
		y--;
		}
		
		break;
		
		case 1:
		//going right
		x++;
		canvasArray[x][y].home = 3;
		break;
		case 2:
		//going up
		y++;
		canvasArray[x][y].home = 4;
		break;
		case 3:
		//going left
		x--;
		canvasArray[x][y].home = 1;
		break;
		case 4:
		//going down
		y--;
		canvasArray[x][y].home = 2;
		break;
		
		}
		
		
	}
	
	}
	
	function arraySetUp(){
	//set everything to false
	for(var i = 0; i < canvas.width; i++){
		for(var j = 0; j < canvas.height; j++){
			canvasArray[i][j] = {visited: false, right: false, up: false, left: false, down: false, home: 0};
			//[have I been here, did I go right, did I go up, did I go left, did I go down, which direction did I come from] 0 = none, 1 = right, 2 = up, 3 = left, 4 = down
			}
			
		}
		
	}

	function within10(first, second){
	
	if (Math.abs(first-second) <= 10){
	return true;
	}
	return false;
	}

	//fill with white (otherwise it says it's filled with black even though it's white)
context.beginPath();
		context.fillStyle = 'white';
		context.strokeStyle = 'white';
		context.fillRect(0, 0, canvas.width, canvas.height);		
		context.fill();
    
	//END OF ADDED SCRIPTS

    

</script>



</body>
</html>

